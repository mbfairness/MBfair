# MBFair: A Model-based Verification Methodology for Detecting Violations of Individual Fairness 
 
In this file we presents our developed artifacts that supports our MBFair methodology. The artifacts include:

* The *UMLfair profile*:a Papyrus editor extension permits annotating UML models with the UMLfair profile.

* The launch configuration to the transformation tool Hugo/RT.

* LTL formulas generator: a prototypical implementation of our  LTL formulas generator.

* Proxy information generator: a prototypical implementation that generates proxy information based on a database.

* The inputs and the outputs of applying our proposed MBFair methodology on three case studies namely, the Bank Management System inspired by a real decision-making
processes, the Delivery Management System based on the incedent describtion of [Amazon's delivery-free service](https://www.bloomberg.com/graphics/2016-amazon-same-day/), and the Loan Management System based on [business process model](https://link.springer.com/chapter/10.1007/978-3-319-92901-9_19) from an [event log](https://www.win.tue.nl/bpi/doku.php?id=2012:challenge) recording the loan management process of a Dutch financial institute. 


# Recources

* **The UMLfair Profile:** https://github.com/mbfairness/MBfair/blob/main/profile.zip
* **The lucn configuration to the transformation tool hugo/RT:** https://github.com/mbfairness/MBfair/blob/main/hugort.launch
* **The LTL generator and the proxy information generator:** https://github.com/mbfairness/MBfair/blob/main/MBFairness.zip

* **Artifacts: The bank management system case study:** https://github.com/mbfairness/MBfair/blob/main/BankManagementSystem.zip
* **Artifacts: The delivery management system case study:** https://github.com/mbfairness/MBfair/blob/main/DeliveryManagementSystem.zip
* **Artifacts: The loan management system case study:** https://github.com/mbfairness/MBfair/blob/main/LoanManagementSystem.zip

The artifacts of each each case study contains: 
* a (*.uml*) file: the UML model of the system annotated with the UMLfair profile.
* Two (*.xlsx*) files. The first is the dataset, which is used to uncover proxies of protected characteristics. The second file is the proxies for the protected characteristics in the model, which is used as input for our LTL formulas generator.  
* a (.pml) file: the result of transforming the UML into PROMELA by using the [Hugo/RT](https://www.informatik.uni-augsburg.de/en/chairs/swt/sse/hugort/) tool. 
* a (*.pdf*) file: provides the LTL formulas together with their verifications results. The verifiaction results are the output of  the [SPIN](http://spinroot.com/spin/whatispin.html) model checker. 
* (*.trail*) files: counterexamples of the violated LTL formulas, generated by the [SPIN](http://spinroot.com/spin/whatispin.html) model checker.

# Step 1: Transforming UML models to PROMELA specifications
The uploaded (.zip) files of the cases studies include all the required artifacts for transforming the UML models to PROMELA specification. Each (.zip) file includes a (.pml) file that shows the result of the transformation. In the following, we explain how  the (.pml) files can be generate using the transformation tool support Hugo/RT.  

## Prerequisite 
We recommend using [Eclipse, Modeling Tools distribution](https://www.eclipse.org/downloads/packages/release/neon/r/eclipse-modeling-tools). 
* install the transformation tool Hugo/RT to your desktop. Information on how to install Hugo/RT can be found from [here](https://www.informatik.uni-augsburg.de/en/chairs/swt/sse/hugort/). You can transform the UML models directly by using the Hugo/RT or via an Eclipse lunch configuration to Hugo/RT as follows.

* Open your Eclipse and create a new empty project and name it *hugoRT*.
* Extract one of (.zip) files of the uploaded case staudies above. Select the (.uml) file and copy it to the created *hugoRT* project in your Eclipse. In the *hugoRT* project change the name of copied UML file to *model.xml*
* Select Eclipse menu item Run→ External Tools → External Tools Configurations…
* Click on the *New Item* icon. Add a name to the created item, for example, *hugort*.
* In the main table, add the directory to java.exe in the location textbox. For example, in my computer, the directory is (**C:\Program Files\Java\jdk1.8.0_241\bin\java.exe**)
* In the working directory textbox, add the directory to the lib forlder of the installed hugo/RT on your desktop. For example, **C:\Users\anonymous\Desktop\hugort-0_8a\lib**.
* Copy and Paste the following lunch configuration to the arguments textbox and change the user name from *user name* to your actuall *user name*: **-jar C:/Users/username/Desktop/hugort-0_8a/lib/hugort.jar -opromela=C:/Users/anonymous/workspace/hugort/model.pml C:/Users/an/workspace/hugort/model.xml**

* Press *Run*. After running the *hugort* lunch file, you should see the console output informing you about the transformation process. The process should take a few milliseconds. The process is finished when the following line is printed to the console: *Writing Promela system to.....*

* The result of the transformatio is (.pml) file saved to the *hugoRT* project directory.

# Step 2: Generating LTL formulas
The uploaded [MBFairness.zip](https://github.com/QRamadan/MBFair/blob/main/MBFairness.zip) file includes all the required artifacts for generating LTL formulas based on the UML models that are annotated with the UMLfair profile. 

## Prerequisite 
We recommend using [Eclipse, Modeling Tools distribution](https://www.eclipse.org/downloads/packages/release/neon/r/eclipse-modeling-tools).

## Performing the generation of LTL formulas. 
To execute the generation of LTL formulas from UML models annotated with the UMLfair profile, please follow the following instruction. 

* Import the project package [MBFairness.zip](https://github.com/QRamadan/MBFair/blob/main/MBFairness.zip)  to your local Eclipse workspace.
* Right-click on the main class *"src/generators/GenerateLTLFormulas.java"* → *Run As Java Application*. Our generator takes as inputs: First, a UML model saved as (.xml) file. Second, information of proxies saved in a (.xlsx) file. By default, our LTL generator takes as input the *bankSystem.xml* and the *ProxyOfBankSystem.xlsx* files. 

* For changing the input (.xml) file: First, copy the name of one of the (.xml) files that are provided in *MBFairness → src → generators* directory. Second, find line 47 in the *GenerateLTLFormulas.java* file (**File inputFile = new File(xmlPath+"\\bankSystem.xml");**) and replace the file name *"bankSystem"* with the name of the selected (.xml) file. 

* For changing the input (.xlsx) file: First, copy the name of the corresponding (.xlsx) file to the selected (.xml) file. The (.xlsx) files are provided in directly in the *MBFairness* directory. Second, find line 65 in the *GenerateLTLFormulas.java* file (**File myExcelBook=new File("ProxyOfBankSystem.xlsx");**) and replace the file name *"ProxyOfBankSystem"* with the name of the selected (.xlsx) file.

* After running the *GenerateLTLFormulas.java* file, you should see the console output informing you about the generation process. The process should take a few milliseconds. The process is finished when the following line is printed to the console: *Completed Successfully! Time[ms]: ...*. The time shows the time needed for generating the LTL formulas.

* The output of running the *GenerateLTLFormulas.java* file is a *Report.txt* file contains batches of LTL formulas. The Report.txt file is saved in the *MBFairness* directory.

* Copy and Paste the generated LTL formulas to the end of the corresponding (.pml) file that is generatd from Step 1 (i.e, Transforming UML models to PROMELA specifications).

# Step 3: Verifying the generated LTL formulas
The uploaded (.zip) files of the cases studies include all the required artifacts for verifying the generated LTL formulas. Each (.zip) file includes a (.pml) file that contains a set of formulas. Also each (.zip) file has a (.pdf) file that shows the formulas and their verification results. In the following, we explain how the LTL formulas can be verified using the  SPIN model checker.  

## Prerequisite 
Install [SpinRCP, An Integrated Development Environment for the Spin Model Checker](http://lms.uni-mb.si/spinrcp/index.html). SpinRCP has dependancy on several external software. Information of the need software can be found  [here](http://lms.uni-mb.si/spinrcp/Download.html).

* Create a workspace folder for the SpinRCP. In the workspace of the SpinRCP, create a folder for your first project.
* Select the (.pml) file that you want to verify its LTL formulas. The (.pml) files are provided in the (.zip) files of our case studies or you can select your (.pml) file that is resulted from performing Step 1 and 2 (i.e., Transforming UML models to PROMELA specifications and Generating LTL formulas).
* Copy the selected (.pml) to your project folder in the workspace of the SpinRCP.
* Open the SpinRCP by doubple click on the *SpinRCP.exe* file. SpinRCP will ask you to specify the directory to the created workspace. 
* In the *Model Navigator* view, you should see the created project and it should contain the selected (.pml) file.
* Open the (.pml) file and then select the SpinRCP menu item *Run→ Syntax Check*. After running the syntax check, you should see the console output informing you about the process. The process should take a few milliseconds. The process is succefully finished when the following line is printed to the console: *No Syntax Error!* 

* Next, select the SpinRCP menu item *Run→ Verification*. 
* In the open window, you should setup the configuration for the verification process as follows. First, regarding the correctness properities, choose only  *Liveness* and *Acceptance cycles*. Second, only select the check-box of *Report unreachable code*.  Second, regarding the storage mode,  choose only *Exhustive*. Then make sure that the check-box of *Apply never formula ...* is selected. Third,  select *In-model LTL formula...*. In the corresponding textbox, add the name of the formula to be verified for example *formula1*. The name represents a reference to the to-be-verified LTL formula. The formulas are provided at the end of the (.pml) model and each formula has a specific number.
* Press *OK*. After running the syntax check, you should see the console output informing you about the verification process. The process should take a few milliseconds. In case the verified formula is violated, an error message will be appear and a (.trail) file will be generated. The (.trail) file is a counterexample of the violated LTL formula. 

* To simulate the (.trail) file, select the SpinRCP menu item *Run→ Simulation*. In the simulation window, select *Guided* and *Using filename.trail*. Then press *OK*  and then Press *Run*.

# Step 4 (Optional): Generating proxies of protected characteristics 
The uploaded [MBFairness.zip](https://github.com/QRamadan/MBFair/blob/main/MBFairness.zip) file includes all the required artifacts for generating proxies of protected characteristics based on data bases of personal information. 


## Performing the proxies generation . 
To execute the generation of proxies, please follow the following instruction. 

* Import the project package [MBFairness.zip](https://github.com/QRamadan/MBFair/blob/main/MBFairness.zip)  to your local Eclipse workspace.
* Right-click on the main class *"src/generators/GenerateMetrics.java"* → *Run As Java Application*. Our algorithm takes as a UML model annotated with fairness-related infomrmation and saved as (.xml) file. The goal of this algorithm is to retrieve the protected characteristics, the name of the correlation metric to be used for measuring correlation and the threshold. The threshold is needed inorder to identfy when a specific data item can act as a proxy for a protected characteristic. The By default, our algorithm takes as input the *bankSystem.xml* file. 

* For changing the input (.xml) file: First, copy the name of one of the (.xml) files that are provided in *MBFairness → src → generators* directory. Second, find line 46 in the *GenerateMetrics.java* file (**File inputFile = new File(xmlPath+"\\bankSystem.xml");**) and replace the file name *"bankSystem"* with the name of the selected (.xml) file. 


* After running the *GenerateMetrics.java* file, you should see the console output informing you about the generation process. The process should take a few milliseconds. The process is finished when the following line is printed to the console: *Completed Successfully!.

* The output of running the *GenerateMetrics.java* file is a *metrics.txt* file contains the required information for generating proxies. Specifically, it contains: a list of protected characteristics, the name of correlation metric and the value for the threshold. 
